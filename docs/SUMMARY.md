# Session Handoff - 2026-02-04

## Session Overview

Upgraded the Next.js project from version 13 to version 14. The user initially asked about Next.js best practices, then decided to upgrade. We chose an incremental upgrade path (13 → 14 only) rather than jumping directly to v15, because v15 requires React 19 which would be a larger breaking change. The upgrade completed successfully with codemods handling the metadata-to-viewport migration.

## What Changed

**Modified:**
- `package.json` - Updated `next` to 14.2.35, `eslint-config-next` to 14.2.35
- `yarn.lock` - Updated dependency tree
- `app/(frontend)/[lang]/layout.tsx` - Migrated `colorScheme` and `themeColor` from `metadata` export to new `viewport` export (v14 requirement)
- `next-env.d.ts` - Regenerated by Next.js

## Key Decisions

1. **Incremental upgrade (v13 → v14 only)** - v15 requires React 19 which would cascade into updating the entire Sanity ecosystem. Safer to stabilize on v14 first.
2. **Skip Sanity ecosystem update** - `next-sanity@5.5.4` shows peer dependency warning but works. Full update would require sanity ^3.37+, @sanity/ui ^2.0+, etc.
3. **Used codemods over manual changes** - Ran `metadata-to-viewport-export` codemod to automatically migrate viewport metadata.

## Current State

- Next.js 14.2.35 installed and working
- Build compiles successfully (`✓ Compiled successfully`)
- Type checking passes
- Viewport metadata properly migrated
- Commit created: `ab74f7d upgrades next.js 13 to 14`

**Warnings (non-blocking):**
- `next-sanity@5.5.4` peer dependency expects `next@^13.0.0`
- `caniuse-lite` outdated (run `npx update-browserslist-db@latest`)
- Sanity API network errors during build (not upgrade-related, happens when API is slow)

## Next Steps

1. [ ] Test the app locally with `yarn dev` to verify everything works
2. [ ] Push the upgrade commit to origin
3. [ ] Consider upgrading Sanity ecosystem (`next-sanity@9` + related packages) for full v14 peer compatibility
4. [ ] When ready for v15: Plan React 18 → 19 migration (requires updating Sanity to v12+)

## Open Questions

- Should the Sanity ecosystem be updated now or later?
- Is the Sanity API network issue during build a recurring problem?

## Context for New Session

**Project:** Inmogolf Bonalba (real estate website)
**Stack:** Next.js 14, React 18, Sanity CMS, TypeScript, Tailwind CSS
**Working in:** Root directory, primarily `app/(frontend)/[lang]/`
**Branch:** `upgrade`
**Node.js:** v23.10.0

**Quick commands:**
- Dev server: `yarn dev`
- Build: `yarn build`
- Lint: `yarn lint`
- Type check: `yarn type-check`

**Upgrade path reference:**
- v14 → v15 requires: React 19, async params/searchParams, `next-sanity@9+`
- Key codemod: `npx @next/codemod@latest next-async-request-api .`
